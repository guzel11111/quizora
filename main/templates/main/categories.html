<!DOCTYPE html>
<html lang="ru">
<head>
  {% load static %}
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Выбор квиза — Quizora</title>
  <link rel="stylesheet" href="{% static 'main/landing.css' %}">
  <link rel="stylesheet" href="{% static 'main/categories.css' %}">
</head>
<body>
  <!-- Фон -->
  <div class="bg" aria-hidden="true"></div>

  <div class="bg-icons" aria-hidden="true">
    <!-- мозг -->
    <svg class="bg-icon bg-icon--brain" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
      <path d="M9 3.5a3 3 0 0 0-3 3V8a3 3 0 0 0-2 3v1a3 3 0 0 0 1.6 2.7A3 3 0 0 0 7 18v1a3 3 0 0 0 3 3"/>
      <path d="M15 3.5a3 3 0 0 1 3 3V8a3 3 0 0 1 2 3v1a3 3 0 0 1-1.6 2.7A3 3 0 0 1 17 18v1a3 3 0 0 1-3 3"/>
      <path d="M12 3.5v18.5"/>
    </svg>

    <!-- лампочка -->
    <svg class="bg-icon bg-icon--bulb" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
      <path d="M12 3a6 6 0 0 0-6 6c0 2.1 1 3.5 2 4.5 1 1.1 2 2.2 2 3.5h4c0-1.3 1-2.4 2-3.5 1-1 2-2.4 2-4.5a6 6 0 0 0-6-6Z"/>
      <path d="M10 18.5h4v2H10Z"/>
      <path d="M10.5 22h3"/>
    </svg>

    <!-- знак вопроса -->
    <svg class="bg-icon bg-icon--question" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
      <path d="M9.5 7a2.5 2.5 0 0 1 2.5-2.5 3 3 0 0 1 3 3c0 1.4-.8 2.1-1.7 2.7-.8.5-1.3 1.1-1.3 2.3V14"/>
      <circle cx="12" cy="18.5" r="1"/>
    </svg>

    <!-- облако мысли -->
    <svg class="bg-icon bg-icon--cloud" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
      <path d="M8 18a3 3 0 0 1-.5-6 4 4 0 0 1 7.7-1.5A3 3 0 0 1 15 18H8Z"/>
      <circle cx="7" cy="20.5" r="0.8"/>
      <circle cx="5.5" cy="22" r="0.5"/>
    </svg>
  </div>

  <!-- Кнопка назад -->
  <div class="back-btn-container">
    <a href="{% url 'main:dashboard' %}" class="back-btn" aria-label="Вернуться в меню">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
    </a>
  </div>

  <!-- Хедер -->
  <header class="dashboard-header">
    <div class="brand" aria-label="Quizora">
      <span class="brand__dot" aria-hidden="true"></span>
      <span class="brand__name">Quizora</span>
    </div>
    <button class="theme-toggle" type="button" id="themeToggle" aria-label="Переключить тему">
      <span class="theme-toggle__track" aria-hidden="true">
        <span class="theme-toggle__thumb" aria-hidden="true"></span>
      </span>
      <span class="theme-toggle__label" id="themeLabel">Светлая</span>
    </button>
  </header>

  <!-- Основной контент -->
  <main class="categories-container">
    <div class="categories-header">
      <h1 class="categories-title">Выбери категорию</h1>
      <p class="categories-subtitle">Или выбери несколько для микса вопросов</p>
    </div>

    <!-- Сетка категорий -->
    <div class="categories-grid" id="categoriesGrid">
      {% for category in categories %}
      <div class="category-card" data-category="{{ category.code }}">
        <svg class="category-icon" viewBox="0 0 24 24">
          {% if category.code == 'general' %}
          <circle cx="12" cy="12" r="9" fill="none" stroke-width="2"/>
          <path d="M12 8v8M8 12h8"/>
          {% elif category.code == 'science' %}
          <path d="M12 2L3 22h18L12 2z" fill="none" stroke-width="2"/>
          <circle cx="12" cy="14" r="2" fill="none" stroke-width="2"/>
          {% elif category.code == 'history' %}
          <path d="M4 4h16v16H4z" fill="none" stroke-width="2"/>
          <path d="M8 8h8M8 12h6M8 16h4"/>
          {% elif category.code == 'geography' %}
          <circle cx="12" cy="12" r="9" fill="none" stroke-width="2"/>
          <path d="M12 3a9 9 0 0 0-9 9 9 9 0 0 0 9 9 9 9 0 0 0 9-9 9 9 0 0 0-9-9z" fill="none" stroke-width="1"/>
          {% elif category.code == 'literature' %}
          <path d="M4 4h16v16H4z" fill="none" stroke-width="2"/>
          <path d="M8 8h8M8 12h6M8 16h4"/>
          {% elif category.code == 'movies' %}
          <rect x="3" y="3" width="18" height="18" rx="2" fill="none" stroke-width="2"/>
          <circle cx="8" cy="12" r="2" fill="none" stroke-width="2"/>
          <circle cx="16" cy="12" r="2" fill="none" stroke-width="2"/>
          {% elif category.code == 'music' %}
          <path d="M9 18V4l12-2v14" fill="none" stroke-width="2"/>
          <circle cx="6" cy="18" r="3" fill="none" stroke-width="2"/>
          <circle cx="18" cy="16" r="3" fill="none" stroke-width="2"/>
          {% elif category.code == 'sports' %}
          <circle cx="12" cy="12" r="9" fill="none" stroke-width="2"/>
          <path d="M12 3a9 9 0 0 0-9 9 9 9 0 0 0 9 9" fill="none" stroke-width="2"/>
          {% elif category.code == 'technology' %}
          <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" fill="none" stroke-width="2"/>
          {% elif category.code == 'astronomy' %}
          <circle cx="12" cy="12" r="3" fill="none" stroke-width="2"/>
          <path d="M5 12h14M12 5v14" fill="none" stroke-width="2"/>
          {% elif category.code == 'art' %}
          <path d="M5 3h14v18H5z" fill="none" stroke-width="2"/>
          <path d="M9 9h6M9 13h6M9 17h3" fill="none" stroke-width="2"/>
          {% elif category.code == 'food' %}
          <path d="M20 11H4c-1.1 0-2 .9-2 2v6c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-6c0-1.1-.9-2-2-2z" fill="none" stroke-width="2"/>
          <path d="M8 3v4M16 3v4" fill="none" stroke-width="2"/>
          {% elif category.code == 'animals' %}
          <path d="M12 8c-2 0-4 1-4 3v6h8v-6c0-1-2-3-4-3z" fill="none" stroke-width="2"/>
          <circle cx="10" cy="6" r="1" fill="none" stroke-width="2"/>
          <circle cx="14" cy="6" r="1" fill="none" stroke-width="2"/>
          {% elif category.code == 'mythology' %}
          <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" fill="none" stroke-width="2"/>
          <circle cx="12" cy="12" r="3" fill="none" stroke-width="2"/>
          {% else %}
          <circle cx="12" cy="12" r="9" fill="none" stroke-width="2"/>
          <path d="M12 8v8M8 12h8"/>
          {% endif %}
        </svg>
        <h3 class="category-name">{{ category.name }}</h3>
        <p class="category-count">
          {% if category.count %}
            {{ category.count }} квиз{% if category.count == 1 %}{% elif category.count < 5 %}а{% else %}ов{% endif %}
          {% else %}
            Нет квизов
          {% endif %}
        </p>
      </div>
      {% endfor %}
    </div>

    <!-- Переключатель микса -->
    <div class="mix-toggle">
      <input type="checkbox" id="mixToggle" class="mix-checkbox">
      <label for="mixToggle" class="mix-label">Перемешать выбранные категории</label>
    </div>

    <!-- Кнопка начала -->
    <div class="start-section">
      <button class="start-btn" id="startBtn" disabled>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 3l14 9-14 9V3z"/>
        </svg>
        Начать квиз
      </button>
    </div>
  </main>

  <script>
    // Получаем все карточки категорий
    const categoryCards = document.querySelectorAll('.category-card');
    const startBtn = document.getElementById('startBtn');
    const mixToggle = document.getElementById('mixToggle');
    
    let selectedCategories = [];

    // Обработчик клика по карточке
    categoryCards.forEach(card => {
      card.addEventListener('click', () => {
        card.classList.toggle('selected');
        const category = card.dataset.category;
        
        if (card.classList.contains('selected')) {
          selectedCategories.push(category);
        } else {
          selectedCategories = selectedCategories.filter(c => c !== category);
        }
        
        // Обновляем кнопку
        updateStartButton();
      });
    });

    // Обновляем состояние кнопки
    function updateStartButton() {
      if (selectedCategories.length > 0) {
        startBtn.disabled = false;
        startBtn.innerHTML = selectedCategories.length === 1 
          ? '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 3l14 9-14 9V3z"/></svg> Начать квиз'
          : `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 3l14 9-14 9V3z"/></svg> Начать микс (${selectedCategories.length})`;
      } else {
        startBtn.disabled = true;
        startBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 3l14 9-14 9V3z"/></svg> Начать квиз';
      }
    }

    // Обработчик кнопки начала
    startBtn.addEventListener('click', () => {
      if (selectedCategories.length === 0) return;
      
      const isMix = mixToggle.checked;
      const params = new URLSearchParams();
      
      selectedCategories.forEach(cat => {
        params.append('category', cat);
      });
      
      if (isMix) {
        params.append('mix', 'true');
      }
      
      // Переходим на страницу квиза
      window.location.href = `/quiz/start/?${params.toString()}`;
    });
  </script>

  <script src="{% static 'main/landing.js' %}" defer></script>
</body>
</html>